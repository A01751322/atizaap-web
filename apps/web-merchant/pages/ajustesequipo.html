<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/navbar.css">
        <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet"/>
    </head>
    <body class="pt-14">
    <!--Placeholder de navbar -->
        <div id="navbar-placeholder"></div> 
    <!-- Script Placeholder de navbar y tokenización -->
        <script>
            document.addEventListener('DOMContentLoaded', async () => {
                const mount = document.getElementById('navbar-placeholder');
                try {
                // cache-buster para evitar versiones viejas en escritorio
                const res = await fetch('../partials/navbar.html?v=' + Date.now());
                if (!res.ok) throw new Error('HTTP ' + res.status);
                const html = await res.text();
                mount.innerHTML = html;

                // Mover el contenido de la página dentro del recuadro con líneas
                const content = document.getElementById('page-content');
                let slot = mount.querySelector('#content-slot');

                // Fallback: si el slot no existe, lo creamos dentro del primer recuadro punteado
                if (!slot) {
                    const dashed = mount.querySelector('.border-dashed.rounded-lg');
                    if (dashed) {
                    slot = document.createElement('div');
                    slot.id = 'content-slot';
                    dashed.appendChild(slot);
                    }
                }

                if (slot && content) {
                    slot.appendChild(content);
                } else {
                    console.warn('No se encontró content-slot ni contenido para mover');
                }

                // Cargar tabs y activar la pestaña correspondiente (forzar por data-active-tab)
                const tabsMount = document.getElementById('tabs-placeholder');
                if (tabsMount) {
                    const tRes = await fetch('../partials/tabsajustes.html?v=' + Date.now());
                    if (!tRes.ok) throw new Error('HTTP ' + tRes.status);
                    tabsMount.innerHTML = await tRes.text();

                    const basic = tabsMount.querySelector('[data-tab="basic"]');
                    const team  = tabsMount.querySelector('[data-tab="team"]');

                    const reset = () => {
                        [basic, team].forEach(a => {
                        if (!a) return;
                        a.classList.remove('text-blue-600','border-blue-600','active','dark:text-blue-500','dark:border-blue-500','border-b-2');
                        a.classList.add('border-transparent');
                        a.removeAttribute('aria-current');
                        });
                    };
                    const setActive = (el) => {
                        if (!el) return;
                        el.classList.add('text-blue-600','border-b-2','border-blue-600','active','dark:text-blue-500','dark:border-blue-500');
                        el.classList.remove('border-transparent');
                        el.setAttribute('aria-current','page');
                    };
                    const setInactive = (el) => {
                        if (!el) return;
                        el.classList.remove('text-blue-600','border-blue-600','active','dark:text-blue-500','dark:border-blue-500','border-b-2');
                        el.classList.add('border-transparent');
                        el.removeAttribute('aria-current');
                    };

                    const desired = document.getElementById('page-content')?.dataset.activeTab || 'basic';
                    const reapply = () => {
                        reset();
                        if (desired === 'team') {
                        setActive(team);
                        setInactive(basic);
                        } else {
                        setActive(basic);
                        setInactive(team);
                        }
                    };

                    reapply();
                    requestAnimationFrame(reapply);
                }


                // Re‑inicializa Flowbite para los elementos añadidos dinámicamente
                if (window.initFlowbite) window.initFlowbite();
                } catch (err) {
                console.error('Error al cargar la barra de navegación:', err);
                mount.innerHTML = '<div class="fixed w-16 h-screen bg-gray-800 text-white p-4">Error al cargar</div>';
                }
            });
        </script>
        <main id="page-content" data-active-tab="team">
            <h1 class="text-3xl font-bold">Ajustes</h1>
            <div id="tabs-placeholder" class="mb-4"></div>

        </main>
    </body>
    <script defer src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
</html>